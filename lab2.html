CREATE TABLE SALESMAN(SALESMAN_ID VARCHAR(8),
		      NAME VARCHAR(20),
		      CITY VARCHAR(20),
		      COMMISSION VARCHAR2(10),
		CONSTRAINT PKS PRIMARY KEY(SALESMAN_ID));

CREATE TABLE CUSTOMER(CUSTOMER_ID VARCHAR(8),
			CUST_NAME VARCHAR2 (20),
			CITY VARCHAR2 (20),
			GRADE NUMBER (3),
			SALESMAN_ID VARCHAR(8),
CONSTRAINT PKC	PRIMARY KEY(CUSTOMER_ID),
CONSTRAINT FKC FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE SET NULL);


CREATE TABLE ORDERS (ORD_NO VARCHAR(8),
		    PURCHASE_AMT NUMBER(10, 2),
	  ORD_DATE DATE,
 CUSTOMER_ID VARCHAR(8),
 SALESMAN_ID VARCHAR(8),
  CONSTRAINT PKO PRIMARY KEY (ORD_NO),
  CONSTRAINT FKOC FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID) ON DELETE CASCADE,
  CONSTRAINT FKOS FOREIGN KEY (SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID) ON DELETE CASCADE);


INSERT INTO SALESMAN VALUES ('1000', 'JOHN','BANGALORE','25%');
INSERT INTO SALESMAN VALUES ('2000', 'RAVI','BANGALORE','20%');
INSERT INTO SALESMAN VALUES ('3000', 'KUMAR','MYSORE','15%');
INSERT INTO SALESMAN VALUES ('4000', 'SMITH','DELHI','30%');
INSERT INTO SALESMAN VALUES ('5000', 'HARSHA','HYDRABAD','15%');




INSERT INTO CUSTOMER VALUES ('C1', 'PREETHI','BANGALORE', 100, '1000');
INSERT INTO CUSTOMER VALUES ('C2', 'VIVEK','MANGALORE', 300, '1000');
INSERT INTO CUSTOMER VALUES ('C3', 'BHASKAR','CHENNAI', 400, '2000');
INSERT INTO CUSTOMER VALUES ('C4', 'CHETHAN','BANGALORE', 200, '2000');
INSERT INTO CUSTOMER VALUES ('C5', 'MAMATHA','BANGALORE', 400, '3000');





INSERT INTO ORDERS VALUES ('O1', 5000, '04-MAY-17', 'C1', '1000');
INSERT INTO ORDERS VALUES ('O2', 6000, '04-MAY-17', 'C1', '1000');
INSERT INTO ORDERS VALUES ('O3', 7000, '04-MAY-17', 'C2', '1000');
INSERT INTO ORDERS VALUES ('O4', 450, '20-JAN-17', 'C1', '2000');
INSERT INTO ORDERS VALUES ('O5', 1000, '24-FEB-17', 'C2','2000');
INSERT INTO ORDERS VALUES ('O6', 3500, '13-APR-17', 'C3', '3000');
INSERT INTO ORDERS VALUES ('O7', 550, '09-MAR-17', 'C4', 2000);
INSERT INTO ORDERS VALUES ('O8', 6500, '04-MAY-17', 'C5', 1000);
INSERT INTO ORDERS VALUES ('O9', 7500, '09-MAR-17', 'C2', 2000);

SELECT * FROM SALESMAN;

SALESMAN 	NAME		      CITY		   COMMISSION
-------- 		-------------------- -------------------- ----------
1000		 JOHN		      BANGALORE 	   25%
2000		 RAVI		      BANGALORE 	   20%
3000		 KUMAR	 MYSORE		   15%
4000		SMITH		      DELHI		   30%
5000		 HARSHA 	      HYDRABAD	   15%


SELECT * FROM CUSTOMER;

CUSTOMER CUST_NAME	      CITY			GRADE    SALESMAN
-------- ------------- -------------------- ---------- --------
C1		PREETHI	      BANGALORE 		 100 		1000
C2		VIVEK		MANGALORE 		300 		1000
C3		BHASKAR	      CHENNAI			400 		2000
C4		 CHETHAN	      BANGALORE 		200 		2000
C5		MAMATHA	      BANGALORE 		  400 		3000


SELECT * FROM ORDERS;

ORD_NO	 PURCHASE_AMT ORD_DATE	CUSTOMER SALESMAN
-------- ------------ --------- -------- --------
O1		 5000 			04-MAY-17	C1		1000
O2		 6000 			04-MAY-17	 C1		 1000
O3		 7000 			04-MAY-17 	C2		1000
O4		 450 			20-JAN-17	 C1		2000
O5		 1000 			24-FEB-17 	C2		 2000
O6		 3500 			13-APR-17	 C3		 3000
O7		 550 			09-MAR-17 	C4		 2000
O8		 6500 			04-MAY-17 	C5		1000
O9		 7500 			09-MAR-17	 C2		 2000
Queries:
1.Count the customers with grades above Bangalore’s average.

SELECT GRADE, COUNT (DISTINCT CUSTOMER_ID) AS NO_OF_CUSTOMER
FROM CUSTOMER
GROUP BY GRADE
HAVING GRADE > (SELECT AVG(GRADE)
	        FROM CUSTOMER
                WHERE CITY='BANGALORE');

OUTPUT:

GRADE     NO_OF_CUSTOMER
---------- --------------
    400		2
    300		1


2.Find the name and numbers of all salesmen who had more than one customer.

SELECT SALESMAN_ID, NAME
  FROM SALESMAN S
  WHERE ((SELECT COUNT (*)
         FROM CUSTOMER
  WHERE SALESMAN_ID=S.SALESMAN_ID)>1);

OUTPUT:

SALESMAN   NAME
--------  		 -----
1000		 JOHN
2000		RAVI

3.List all salesmen and indicate those who have and don’t have customers in their cities (Use UNION operation.)

 SELECT S.SALESMAN_ID, S.CITY
 FROM SALESMAN S
 WHERE EXISTS (SELECT CITY FROM CUSTOMER WHERE S.CITY=CITY AND
 S.SALESMAN_ID=SALESMAN_ID)
  UNION
 SELECT SALESMAN_ID,'NO MATCH OF CITIES'
 FROM SALESMAN S
 WHERE NOT EXISTS (SELECT CITY FROM CUSTOMER WHERE S.CITY=CITY AND
 S.SALESMAN_ID=SALESMAN_ID);


OUTPUT:

SALESMAN CITY
-------- --------------------
1000		BANGALORE
2000		BANGALORE
3000		NO MATCH OF CITIES
4000		NO MATCH OF CITIES
5000		NO MATCH OF CITIES








4.Create a view that finds the salesman who has the customer with the highest order of a day.

SELECT  DISTINCT S.SALESMAN_ID,S.ORD_DATE FROM ORDERS S
WHERE (SELECT SUM(PURCHASE_AMT) FROM ORDERS WHERE 
SALESMAN_ID=S.SALESMAN_ID AND ORD_DATE=S.ORD_DATE AND S.CUSTOMER_ID=CUSTOMER_ID)
=(SELECT MAX(SUM(PURCHASE_AMT)) 
FROM ORDERS S1 WHERE  S1.ORD_DATE=S.ORD_DATE GROUP BY S1.ORD_DATE,S1.SALESMAN_ID,S1.CUSTOMER_ID);

OUTPUT:
 SALESMAN ORD_DATE
-------- ---------
1000		04-MAY-17
3000		13-APR-17
2000		20-JAN-17
2000		24-FEB-17
2000		09-MAR-17

5.Demonstrate the DELETE operation by removing salesman with id 1000. All his orders must also be deleted.
   Use ON DELETE CASCADE at the end of foreign key definitions while creating child tableorders and then execute the following:
   Use ON DELETE SET NULL at the end of foreign key definitions while creating child tablecustomers and then executes the following:

DELETE FROM SALESMAN
       WHERE SALESMAN_ID=1000;

SQL> SELECT * FROM SALESMAN;

SALESMAN NAME		CITY		   COMMISSION
-------- 		--------------            --------------------	 ----------
2000		 RAVI			BANGALORE 		20%
3000		KUMAR		 MYSORE			15%
4000		 SMITH		DELHI			30%
5000		HARSHA 	HYDRABAD			15%

 SQL> SELECT * FROM CUSTOMER;

CUSTOMER CUST_NAME	 CITY			GRADE   SALESMAN
-------		--------------------------------- ---------- --------
C1		PREETHI	      BANGALORE 		 100
C2		VIVEK		MANGALORE 		 300
C3		 BHASKAR	      CHENNAI			 400 		2000
C4		CHETHAN	      BANGALORE 		 200 		2000
C5		MAMATHA	      BANGALORE 		 400 		3000

SQL> SELECT * FROM ORDERS;

ORD_NO   PURCHASE_AMT ORD_DATECUSTOMER SALESMAN
-------- ------------ 	-------- -------- --------
O2		  450 		20-JAN-17 	C1		2000
O3		 1000 		24-FEB-17 	C2		 2000
O4		 3500 		13-APR-17 	C3		3000
